version: 2

models:
  - name: int_product_hierarchy
    columns:
      - name: product_id
        tests: [not_null, unique]
      - name: brand_id
        tests:
          - relationships: {to: ref('stg_brands'), field: brand_id}
      - name: category_id
        tests:
          - relationships: {to: ref('stg_categories'), field: category_id}

  - name: int_order_items_enriched
    columns:
      - name: order_id
        tests:
          - not_null
          - relationships: {to: ref('stg_orders'), field: order_id}
      - name: product_id
        tests:
          - not_null
          - relationships: {to: ref('stg_products'), field: product_id}
      - name: store_id
        tests:
          - not_null
          - relationships: {to: ref('stg_stores'), field: store_id}
      - name: customer_id
        tests:
          - not_null
          - relationships: {to: ref('stg_customers'), field: customer_id}
      - name: staff_id
        tests:
          - relationships: {to: ref('stg_staffs'), field: staff_id}
      - name: net_amount
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: discount
        tests:
          - dbt_utils.expression_is_true:
              expression: "between 0 and 1"

  - name: int_orders_enriched
    columns:
      - name: order_id
        tests: [not_null, unique]
      - name: customer_id
        tests:
          - relationships: {to: ref('stg_customers'), field: customer_id}
      - name: store_id
        tests:
          - relationships: {to: ref('stg_stores'), field: store_id}
      - name: staff_id
        tests:
          - relationships: {to: ref('stg_staffs'), field: staff_id}
      - name: lead_time_days
        tests:
          - dbt_utils.expression_is_true:
              expression: "is null or lead_time_days >= 0"

  - name: int_orders_per_order
    columns:
      - name: order_id
        tests: [not_null, unique]
      - name: order_net
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: int_sales_daily_store_product
    columns:
      - name: order_day
        tests: [not_null]
      - name: store_id
        tests:
          - not_null
          - relationships: {to: ref('stg_stores'), field: store_id}
      - name: product_id
        tests:
          - not_null
          - relationships: {to: ref('stg_products'), field: product_id}
      - name: units_sold
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: revenue_net
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: int_customer_orders_agg
    columns:
      - name: customer_id
        tests:
          - not_null
          - relationships: {to: ref('stg_customers'), field: customer_id}
      - name: orders_count
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: total_revenue_net
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: int_staff_productivity
    columns:
      - name: staff_id
        tests:
          - not_null
          - relationships: {to: ref('stg_staffs'), field: staff_id}
      - name: orders_count
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: revenue_managed
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: int_stock_by_store_product
    columns:
      - name: store_id
        tests:
          - not_null
          - relationships: {to: ref('stg_stores'), field: store_id}
      - name: product_id
        tests:
          - not_null
          - relationships: {to: ref('stg_products'), field: product_id}
      - name: stock_qty
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: int_calendar
    columns:
      - name: date_day
        tests: [not_null, unique]